name: "new-issue"
on:
  issues:
    types: [opened, edited]
jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
    - uses: github/issue-labeler@v2.0
      with:
        repo-token: "${{ secrets.GITHUB_TOKEN }}"
        configuration-path: .github/labeler.yml
        enable-versioned-regex: 0
  missed-info:
    runs-on: ubuntu-latest
    needs: [triage]
    outputs:
      test: ${{ steps.steps_to_reproduce.outputs.test }}
    steps:
      - uses: actions/checkout@v2.0.0 
      - name: Missed Steps to reproduce
        id: steps_to_reproduce
        env:
          #if: ${{contains(github.event.issue.body, 'Steps to reproduce') == false}}
          STEPS_REPRODUCE: Steps to reproduce
        run: echo "::set-output name=test::{\"include\":[{\"project\":\"foo\",\"config\":\"Debug\"},{\"project\":\"bar\",\"config\":\"Release\"}]}"
      - name: Missed Link to a GitHub repository
        if: contains(github.event.issue.body, 'Link to a GitHub repository') == false
        env:
          LINK_TO_GITHUB: Link to a GitHub repository
        run: echo "::set-output name=matrix::{\"include\":[{\"project\":\"foo\",\"config\":\"Debug\"},{\"project\":\"bar\",\"config\":\"Release\"}]}"
      - name: Missed Expected result
        if: contains(github.event.issue.body, 'Expected result') == false
        env:
          EXPECTED_RESULT: Expected result
        run: echo "$EXPECTED_RESULT"
      - name: Missed Actual result
        if: contains(github.event.issue.body, 'Actual result') == false
        env:
          ACTUAL_RESULT: Actual result
        run: echo "$ACTUAL_RESULT"
      - name: Missed CLI version
        if: contains(github.event.issue.body, 'CLI version') == false
        env:
          CLI_VERSION: CLI version
        run: echo "$CLI_VERSION"
      - name: Missed plugin version
        if: contains(github.event.issue.body, 'plugin version') == false
        env:
          PLUGIN_VERSION: Plugin version
        run: echo "$PLUGIN_VERSION"
      - name: Missed OS version
        if: contains(github.event.issue.body, 'OS') == false
        env:
          OS_VERSION: OS version
        run: echo "$OS_VERSION"
  display-message:
    runs-on: ubuntu-latest
    needs: [missed-info]
    steps:
      - name: issue comment
        id: issue_comment
        uses: ./
        with: 
          repo-token: ${{ secrets.GITHUB_TOKEN}}
          message: >
            ==================================================
            Check this ${{toJson(needs.missed-info)}}
            ==================================================
      - name: log action output
        run: echo ${{steps.run_action.outputs.message}}
